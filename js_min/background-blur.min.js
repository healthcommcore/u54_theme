!function(h){"use strict";var i=function(){for(var t=3,e=document.createElement("div"),i=e.getElementsByTagName("i");e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e",i[0];);return 4<t?t:void 0}(),n=function(){return"_"+Math.random().toString(36).substr(2,9)},d={svgns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(t,e){var i=document.createElementNS(d.svgns,t);return e&&d.setAttr(i,e),i},setAttr:function(t,e){for(var i in e)"href"===i?t.setAttributeNS(d.xlink,i,e[i]):t.setAttribute(i,e[i]);return t}},o=function(t,e){this.internalID=n(),this.$element=h(t),this.$width=this.$element.width(),this.$height=this.$element.height(),this.element=t,this.options=h.extend({},o.DEFAULTS,e),this.$overlayEl=this.createOverlay(),this.$blurredImage={},this.useVelocity=this.detectVelocity(),this.attachListeners(),this.generateBlurredImage(this.options.imageURL)};o.VERSION="0.1.1",o.DEFAULTS={imageURL:"",blurAmount:10,imageClass:"",overlayClass:"",duration:!1,opacity:1},o.prototype.detectVelocity=function(){return!!window.jQuery.Velocity},o.prototype.attachListeners=function(){this.$element.on("ui.blur.loaded",h.proxy(this.fadeIn,this)),this.$element.on("ui.blur.unload",h.proxy(this.fadeOut,this))},o.prototype.fadeIn=function(){this.options.duration&&0<this.options.duration&&(this.useVelocity?this.$blurredImage.velocity({opacity:this.options.opacity},{duration:this.options.duration}):this.$blurredImage.animate({opacity:this.options.opacity},{duration:this.options.duration}))},o.prototype.fadeOut=function(){this.options.duration&&0<this.options.duration?this.useVelocity?this.$blurredImage.velocity({opacity:0},{duration:this.options.duration}):this.$blurredImage.animate({opacity:0},{duration:this.options.duration}):this.$blurredImage.css({opacity:0})},o.prototype.generateBlurredImage=function(t){var e=this.$blurredImage;this.internalID=n(),0<e.length&&(this.options.duration&&0<this.options.duration?this.useVelocity?e.first().velocity({opacity:0},{duration:this.options.duration,complete:function(){e.remove()}}):e.first().animate({opacity:0},{duration:this.options.duration,complete:function(){e.remove()}}):e.remove()),this.$blurredImage=i?this.createIMG(t,this.$width,this.$height):this.createSVG(t,this.$width,this.$height)},o.prototype.createOverlay=function(){return!(!this.options.overlayClass||""===this.options.overlayClass)&&h("<div></div>").prependTo(this.$element).addClass(this.options.overlayClass)},o.prototype.createSVG=function(t,e,i){var n=this,o=d.createElement("svg",{xmlns:d.svgns,version:"1.1",width:e,height:i,id:"blurred"+this.internalID,class:this.options.imageClass,viewBox:"0 0 "+e+" "+i,preserveAspectRatio:"none"}),r="blur"+this.internalID,s=d.createElement("filter",{id:r}),a=d.createElement("feGaussianBlur",{in:"SourceGraphic",stdDeviation:this.options.blurAmount}),u=d.createElement("image",{x:0,y:0,width:e,height:i,externalResourcesRequired:"true",href:t,style:"filter:url(#"+r+")",preserveAspectRatio:"none"});u.addEventListener("load",function(){n.$element.trigger("ui.blur.loaded")},!0),u.addEventListener("SVGLoad",function(){n.$element.trigger("ui.blur.loaded")},!0),s.appendChild(a),o.appendChild(s),o.appendChild(u);var l=h(o);return n.options.duration&&0<n.options.duration&&(l.css({opacity:0}),window.setTimeout(function(){"0"===l.css("opacity")&&l.css({opacity:1})},this.options.duration+100)),this.element.insertBefore(o,this.element.firstChild),l},o.prototype.createIMG=function(t,e,i){var n=this,o=this.prependImage(t),r=100<2*this.options.blurAmount?100:2*this.options.blurAmount;return o.css({filter:"progid:DXImageTransform.Microsoft.Blur(pixelradius="+r+") ",top:2.5*-this.options.blurAmount,left:2.5*-this.options.blurAmount,width:e+2.5*this.options.blurAmount,height:i+2.5*this.options.blurAmount}).attr("id","blurred"+this.internalID),o.load(function(){n.$element.trigger("ui.blur.loaded")}),this.options.duration&&0<this.options.duration&&window.setTimeout(function(){"0"===o.css("opacity")&&o.css({opacity:1})},this.options.duration+100),o},o.prototype.prependImage=function(t){var e=h('<img src="'+t+'" />');return this.$overlayEl?e.insertBefore(this.$overlayEl).attr("id",this.internalID).addClass(this.options.imageClass):e.prependTo(this.$element).attr("id",this.internalID).addClass(this.options.imageClass)};var t=h.fn.backgroundBlur;h.fn.backgroundBlur=function(n){return this.each(function(){var t=h(this),e=t.data("plugin.backgroundBlur"),i=h.extend({},o.DEFAULTS,t.data(),"object"==typeof n&&n);e||t.data("plugin.backgroundBlur",e=new o(this,i)),"fadeIn"===n?e.fadeIn():"fadeOut"===n?e.fadeOut():"string"==typeof n&&e.generateBlurredImage(n)})},h.fn.backgroundBlur.Constructor=o,h.fn.backgroundBlur.noConflict=function(){return h.fn.backgroundBlur=t,this}}(jQuery);